# Распределённый вычислитель арифметических выражений.

### Установка проекта:

1) Склонировать репозиторий используя команду: git clone https://github.com/ekateri9a/arithmetic-expression-calculator
2) Установить версию go 1.21.10 или выше
3) Наличие утилиты make для файлов Makefiles

**Важно** запустить оркестратор до агента!!!

### Запуск проекта с помощью файла Makefiles из консоли Windows:
1) Перейти в папку arithmetic-expression-calculator
2) В терминале выполнить запуск _**оркестратора**_ с помощью команды:
   * make run-orchestrator-windows
3) Открыть новый терминал и выполнить запуск _**агента**_ с помощью команды:
   * make run-agent-windows

### Запуск проекта с помощью файла Makefiles из консоли Linux:
1) Перейти в папку arithmetic-expression-calculator
2) В терминале выполнить запуск _**оркестратора**_ с помощью команды:
   * make run-orchestrator-linux
3) Открыть новый терминал и выполнить запуск _**агента**_ с помощью команды:
   * make run-agent-linux


### Запуск проекта из консоли:
1) Перейти в папку arithmetic-expression-calculator\cmd\orchestrator и выполнить запуск _**оркестратора**_ с помощью команды: 
   * go run main.go 
   
2) Перейти в папку arithmetic-expression-calculator\cmd\agent и выполнить запуск _**агента**_ с помощью команды:
   * go run main.go
   
##  Постановка задачи

Пользователь хочет считать арифметические выражения. Он вводит строку `2 + 2 * 2` и хочет получить в ответ `6`. Но наши операции сложения и умножения (также деления и вычитания) выполняются "очень-очень" долго. Поэтому вариант, при котором пользователь делает http-запрос и получает в качестве ответа результат, невозможна. Более того, вычисление каждой такой операции в нашей "альтернативной реальности" занимает "гигантские" вычислительные мощности. Соответственно, каждое действие мы должны уметь выполнять отдельно и масштабировать эту систему можем добавлением вычислительных мощностей в нашу систему в виде новых "машин". Поэтому пользователь может с какой-то периодичностью уточнять у сервера "не посчиталось ли выражение"? Если выражение наконец будет вычислено - то он получит результат. Помните, что некоторые части арифметического выражения можно вычислять параллельно.

Back-end часть состоит из 2 элементов:

- Сервер, который принимает арифметическое выражение, переводит его в набор последовательных задач и обеспечивает порядок их выполнения. Далее будем называть его "оркестратором".

- Вычислитель, который может получить от "оркестратора" задачу, выполнить его и вернуть серверу результат. Далее будем называть его "агентом".

## 1. Оркестратор
   Сервер, который имеет следующие endpoint-ы:


## - Добавление вычисления арифметического выражения

* Пример запроса для Windows
```
curl --location 'http://localhost:8081/calculate' \
--header 'Content-Type: application/json' \
--data '{
    "expression": "1+2*(3^4-5) ^(6 - 7 + 3)-8.9"
}'
```

* Пример запроса для Linux
```
wget --no-check-certificate --quiet \
  --method POST \
  --timeout=0 \
  --header 'Content-Type: application/json' \
  --body-data '{
    "expression": "1+2*(3^4-5) ^(6 - 7 + 3)-8.9"
}' \
   'http://localhost:8081/calculate'
```


Cтрока с выражением не поддерживает деление на ноль и числа с унарным минусом.
Операции для вычислений: сложение +, вычитание -, умножение *, деление /, возведение в степень ^ 
Можно использовать дробные числа. В дробных числах используется точка: 6.6

Коды ответа:
201 - выражение принято для вычисления
422 - невалидные данные
500 - что-то пошло не так

Тело ответа

```
{
"id": <уникалиный идентификатор выражения>
}
```


## - Получение списка выражений

* Пример запроса для Windows
```
curl --location 'http://localhost:8081/expressions'
```

* Пример запроса для Linux
```
wget --no-check-certificate --quiet \
  --method GET \
  --timeout=0 \
  --header '' \
   'http://localhost:8081/expressions'
```

Тело ответа

```
{
          "expressions": [
                {
                      "id": <идентификатор выражения>,
                      "status": <статус вычисления выражения>,
                      "result": <результат выражения>
                },
                {
                      "id": <идентификатор выражения>,
                      "status": <статус вычисления выражения>,
                      "result": <результат выражения>
                 }
            ]
}

```

Коды ответа:
* 200 - успешно получен список выражений
* 500 - что-то пошло не так

## - Получение выражения по его идентификатору

Пусть идентификатор expression равен 1

* Пример запроса для Windows
```
curl --location 'http://localhost:8081/expressions/:1'
```

* Пример запроса для Linux
```
wget --no-check-certificate --quiet \
  --method GET \
  --timeout=0 \
  --header '' \
   'http://localhost:8081/expressions/:1'
```

Коды ответа:
* 200 - успешно получено выражение
* 404 - нет такого выражения
* 500 - что-то пошло не так

Тело ответа

```
{
       "expression":
             {

                    "id": <идентификатор выражения>,
                    "status": <статус вычисления выражения>,
                    "result": <результат выражения>
              }
 }
 
```

## - Получение задачи для выполения.

* Пример запроса для Windows
```
curl --location 'http://localhost:8081/internal/task'
```

* Пример запроса для Linux
```
wget --no-check-certificate --quiet \
  --method GET \
  --timeout=0 \
  --header '' \
   'http://localhost:8081/internal/task'
```

Коды ответа:
* 200 - успешно получена задача
* 404 - нет задачи
* 500 - что-то пошло не так

Тело ответа

```
{
       "task":
             {
                   "id": <идентификатор задачи>,
                   "arg1": <имя первого аргумента>,
                   "arg2": <имя второго аргумента>,
                   "operation": <операция>,
                   "operation_time": <время выполнения операции>
              }
}
 
```

## - Прием результата обработки данных.

* Пример запроса для Windows
```
curl --location 'http://localhost:8081/internal/task' \
--header 'Content-Type: application/json' \
--data '{
      "id": "1-0",
      "result": 8
}'
```

* Пример запроса для Linux
```
wget --no-check-certificate --quiet \
  --method POST \
  --timeout=0 \
  --header 'Content-Type: application/json' \
  --body-data '{
      "id": "1-0",
      "result": 8
}' \
   'http://localhost:8081/internal/task'
```


Коды ответа:
* 200 - успешно записан результат
* 404 - нет такой задачи
* 422 - невалидные данные
* 500 - что-то пошло не так

Время выполнения операций задается переменными среды в милисекундах

* TIME_ADDITION_MS - время выполнения операции сложения в милисекундах (по умолчанию 2000)
* TIME_SUBTRACTION_MS - время выполнения операции вычитания в милисекундах (по умолчанию 2000)
* TIME_MULTIPLICATIONS_MS - время выполнения операции умножения в милисекундах (по умолчанию 2000)
* TIME_DIVISIONS_MS - время выполнения операции деления в милисекундах (по умолчанию 2000)
* TIME_EXPONENTIATION_MS - время выполнения операции возведения в степень в милисекундах (по умолчанию 2000)

Порт для сервера задается переменной среды SERVER_PORT (по умолчанию 8081)

# 2. Агент

Демон, который получает выражение для вычисления с сервера, вычисляет его и отправляет на сервер результат выражения.

При старте демон запускает несколько горутин, каждая из которых выступает в роли независимого вычислителя. Количество горутин регулируется переменной среды
COMPUTING_POWER (по умолчанию 3)

Агент обязательно общается с оркестратором по http

Агент все время приходит к оркестратору с запросом "дай задачку поработать" (в ручку GET internal/task для получения задач). Оркестратор отдаёт задачу.

Агент производит вычисление и в ручку оркестратора (POST internal/task для приёма результатов обработки данных) отдаёт результат
